"""
Vulnerability data models
"""

from enum import Enum
from typing import List, Optional, Dict, Any
from datetime import datetime
from pydantic import BaseModel, Field

class VulnerabilitySeverity(str, Enum):
    """Vulnerability severity levels"""
    CRITICAL = "critical"
    HIGH = "high"
    MEDIUM = "medium"
    LOW = "low"
    NONE = "none"
    UNKNOWN = "unknown"

class CVSS(BaseModel):
    """Common Vulnerability Scoring System data"""
    version: str = Field(description="CVSS version (2.0, 3.0, 3.1)")
    vector_string: Optional[str] = Field(default=None, description="CVSS vector string")
    base_score: float = Field(description="Base CVSS score (0.0-10.0)")
    severity: VulnerabilitySeverity = Field(description="Severity rating")

class Vulnerability(BaseModel):
    """Vulnerability information"""
    id: str = Field(description="Vulnerability identifier (CVE, GHSA, etc.)")
    title: Optional[str] = Field(default=None, description="Vulnerability title")
    description: Optional[str] = Field(default=None, description="Detailed description")
    severity: VulnerabilitySeverity = Field(description="Overall severity")
    cvss: Optional[CVSS] = Field(default=None, description="CVSS scoring data")
    cwe_ids: List[str] = Field(default_factory=list, description="Related CWE identifiers")
    published: Optional[datetime] = Field(default=None, description="Publication date")
    updated: Optional[datetime] = Field(default=None, description="Last update date")
    references: List[str] = Field(default_factory=list, description="Reference URLs")
    affected_versions: List[str] = Field(default_factory=list, description="Affected version ranges")
    fixed_versions: List[str] = Field(default_factory=list, description="Fixed version numbers")
    
class ComponentVulnerabilities(BaseModel):
    """Vulnerabilities for a specific component"""
    component_name: str = Field(description="Component name")
    component_version: Optional[str] = Field(description="Component version")
    purl: Optional[str] = Field(description="Package URL")
    vulnerabilities: List[Vulnerability] = Field(description="List of vulnerabilities")
    scan_date: datetime = Field(default_factory=datetime.utcnow, description="When the scan was performed")